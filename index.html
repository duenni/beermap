<!DOCTYPE html>
<html lang="en">
<head>

    <!-- Basic Page Needs 
    –––––––––––––––––––––––––––––––––––––––––––––––––– -->
    <meta charset="utf-8">
    <title>Beermap</title>
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Mobile Specific Metas
    –––––––––––––––––––––––––––––––––––––––––––––––––– -->
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- CSS
    –––––––––––––––––––––––––––––––––––––––––––––––––– -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/modal.css">
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" />

    <!-- Script
    –––––––––––––––––––––––––––––––––––––––––––––––––– -->
    <script src="http://cdn.leafletjs.com/leaflet-0.7/leaflet.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="js/easy-button.js"></script>
    <script type='text/javascript' src='js/biere.json'></script>
    <script type='text/javascript' src='js/canvasjs.min.js'></script>
    <script type='text/javascript' src='js/apikey.js'></script>

    <!-- Favicon
    –––––––––––––––––––––––––––––––––––––––––––––––––– -->
    <link rel="icon" type="image/x-icon" href="images/favicon.ico">

</head>
<body>

    <!-- Primary Page Layout
    –––––––––––––––––––––––––––––––––––––––––––––––––– -->

    <div id="map"></div>

    <section class="modal--show" id="modal-text" tabindex="-1" role="dialog" aria-labelledby="modal-label" aria-hidden="true">
        <div class="modal-inner">
            <header id="modal-label"><!-- Header --><i class="fa fa-bar-chart">&nbsp;</i>More stats</header>
            <div class="modal-content"><!-- The modals content -->
                <div id="chartContainer" style="height: 300px; width: 100%;">
                <script type='text/javascript' src='js/canvas-charts.js'></script></div>
                <div id="sum"></div>
            </div>
        </div>
        <a href="#!" class="modal-close" title="Close this modal" data-close="Close" data-dismiss="modal">?</a>
    </section>
    <a id="modal-link" href="#modal-text"></a>

    <script>
        //Initialize map
        var map = L.map('map', {
            center: [20.0, 5.0],
            zoom: 2,
            worldCopyJump: true,
            layers: new L.tileLayer('https://{s}.tiles.mapbox.com/v4/duenni.847e1c91/{z}/{x}/{y}.png?access_token='+apikey.mapbox+'')
        });
        
        //Change marker icon
        var myIcon = L.icon({
            iconUrl: './images/bier24.png',
            iconRetinaUrl: './images/bier48.png',
            iconSize: [24, 24],
        });
        
        //Copyright information
        map.attributionControl.addAttribution('&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="https://www.mapbox.com/about/maps/">Mapbox</a> | <a href="https://www.mapbox.com/map-feedback/">Improve this map</a>');

        
        //EasyButton Wiki
        L.easyButton('fa fa-beer', 
            function (){
                window.open('http://www.massafaka.at/massawiki/doku.php?id=bierstats:uebersicht');
            },
         'Bieruebersicht'
        )
        
        //EasyButton Github
        L.easyButton('fa fa-github', 
            function (){
                window.open('https://github.com/duenni/beermap');
            },
            'Github'
        )
        
        //EasyButton more stats
        L.easyButton('fa fa-bar-chart', 
            function (){
                $('#modal-link')[0].click();
            },
            'More stats'
        )
        //Use kimonolabs for scraping 
        $.ajax({
            "url":"https://www.kimonolabs.com/api/6qium7f6?apikey="+apikey.kimonolabs,
            "crossDomain": true,
            "dataType": "jsonp",
            //Make a call to the Kimono API following the "url" 
    
            'success': function(response){ 
            // If the call request was successful and the data was retrieved, this function will create a list displaying the data
         
                var collection = response.results.bierherkunft;
                for (var i=0; i < markers.length; i++) 
                {
                    for (var i = 0; i < collection.length; i++)
                    {   
                        L.marker( [markers[i].lat, markers[i].long], {icon: myIcon})
                        .bindPopup('<i class="fa fa-flag"></i> <a target="_blank" href='+collection[i].name.href+'>'+collection[i].name.text+'</a> <br> <i class="fa fa-slack"></i> '+collection[i].anzahl)
                        .addTo(map);
                    }
                }
                var sum = 0;
                for( var i = 0; i < collection.length; i++ ) {
                    sum += parseInt(collection[i].anzahl);
                }
                $( "#sum" ).html( '<i class="fa fa-folder-open">&nbsp;</i>Biere im Wiki: ' + sum );
                
            }
        }); 
    </script>
    <!-- End Document
    –––––––––––––––––––––––––––––––––––––––––––––––––– -->
</body>
</html>